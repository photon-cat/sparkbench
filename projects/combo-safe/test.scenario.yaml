name: combo-safe basic functional test
version: 1
steps:
  # Wait for boot message
  - wait-serial: "=== COMBO SAFE v1.0 ==="
    timeout: 5000

  # Check display is active
  - expect-display:
      part-id: oled1
      min-filled: 50

  # Enter digit 1: rotate to 7 (the correct first digit)
  - set-control:
      part-id: encoder1
      control: rotate-cw
      value: 7
  - delay: 200

  # Press encoder button to confirm digit 1
  - set-control:
      part-id: encoder1
      control: pressed
      value: 1
  - delay: 100
  - set-control:
      part-id: encoder1
      control: pressed
      value: 0
  - delay: 500

  - wait-serial: "[input] Digit 1 = 7"
    timeout: 3000

  # Enter digit 2: rotate to 3
  - set-control:
      part-id: encoder1
      control: rotate-cw
      value: 3
  - delay: 200

  # Confirm digit 2
  - set-control:
      part-id: encoder1
      control: pressed
      value: 1
  - delay: 100
  - set-control:
      part-id: encoder1
      control: pressed
      value: 0
  - delay: 500

  - wait-serial: "[input] Digit 2 = 3"
    timeout: 3000

  # Enter digit 3: rotate to 9
  - set-control:
      part-id: encoder1
      control: rotate-cw
      value: 9
  - delay: 200

  # Confirm digit 3
  - set-control:
      part-id: encoder1
      control: pressed
      value: 1
  - delay: 100
  - set-control:
      part-id: encoder1
      control: pressed
      value: 0
  - delay: 1000

  - wait-serial: "[safe] UNLOCKED!"
    timeout: 5000
